---
- name: Check for oh_my_zsh script
  ansible.builtin.stat:
    path: /tmp/oh-my-zsh.sh
  register: oh_my_zsh_script

- name: Get oh_my_zsh 
  ansible.builtin.get_url:
    url: '{{ script.url }}'
    dest: '{{ script.dest }}'
    mode: 0755
  loop:
    - { url: 'https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh', dest: '/tmp/oh-my-zsh.sh'}
  loop_control:
    loop_var: script
  when: not oh_my_zsh_script.stat.exists

- name: Check if oh_my_zsh is installed.
  ansible.builtin.stat:
    path: $HOME/.oh-my-zsh/
  register: oh_my_zsh_installed

- name: Install oh-my-zsh.
  ansible.builtin.shell:
    cmd: /bin/bash /tmp/oh-my-zsh.sh
  when: oh_my_zsh_script.stat.exists and not oh_my_zsh_installed.stat.exists
  
- name: Check if oh-my-zsh folder exists.
  ansible.builtin.stat:
    path: $HOME/.oh-my-zsh/custom/plugins/
  register: oh_my_zsh_plugins

- name: Install Custom Themes & Plugins
  ansible.builtin.git:
    repo: '{{ git.repo }}'
    dest: '{{ git.dest }}'
    clone: true
    update: true
  loop:
    - { repo: 'git@github.com:zsh-users/zsh-syntax-highlighting.git', dest: '$HOME/.oh-my-zsh/custom/plugins/zsh-syntax-highlighing'}
    - { repo: 'git@github.com:zsh-users/zsh-autosuggestions.git', dest: '$HOME/.oh-my-zsh/custom/plugins/zsh-autosuggestions'}
    - { repo: 'git@github.com:romkatv/powerlevel10k.git', dest: '$HOME/.oh-my-zsh/custom/themes/powerlevel10k' }
  loop_control:
    loop_var: git

- name: Install colorls
  community.general.gem:
    name: '{{ gem.name }}'
    state: '{{ gem.state }}'
  loop:
    - { name: 'colorls', state: 'latest' }
  loop_control:
    loop_var: gem
