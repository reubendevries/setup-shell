---
- name: "Set variable required_packages to false."
  ansible.builtin.set_fact:
    required_packages: false

- name: "Add repositories for required packages."
  become: true
  ansible.builtin.yum_repository:
    name: "{{ repository.name }}"
    description: "{{ repository.description }}"
    baseurl: "{{ repository.baseurl }}"
    state: present
    gpgkey: "/etc/pki/rpm-gpg/{{ repository.gpgkey }}"
    gpgcheck: true
    enabled: true
  loop:
    - {
        name: "opentofu",
        description: "opentofu",
        baseurl: "https://packages.opentofu.org/opentofu/tofu/rpm_any/rpm_any/$basearch",
        gpgkey: "https://packages.opentofu.org/opentofu/tofu/gpgkey"
      }
    - {
        name: "vscodium",
        description: "vscodium",
        baseurl: "https://download.vscodium.com/rpms/",
        gpgkey: "https://gitlab.com/paulcarroty/vscodium-deb-rpm-repo/-/raw/master/pub.gpg"
      }
    - { 
        name: "hashicorp",
        description: "hashicorp",
        baseurl: "https://rpm.releases.hashicorp.com/RHEL/$releasever/$basearch/stable",
        gpgkey: "https://rpm.releases.hashicorp.com/gpg"
      }
    - {
        name: "google_cloud",
        description: "google cloud",
        baseurl: "https://packages.cloud.google.com/yum/repos/cloud-sdk-el9-x86_64",
        gpgkey: "https://packages.cloud.google.com/apt/doc/rpm-package-key.gpg"
      }
    - {
        name: "microsoft",
        description: "microsoft",
        baseurl: "https://packages.microsoft.com/repos/azure-cli/",
        gpgkey: "https://packages.microsoft.com/keys/microsoft.asc"
      } 
  loop_control:
    loop_var: repository

- name: "Updated DNF Cache"
  become: true
  ansible.builtin.dnf:
    update_cache: true
  register: dnf_cache_updated

- name: "Install required packages via dnf."
  become: true
  ansible.builtin.dnf:
    name: "{{ dnf_package.name }}"
    state: latest
  loop:
    - { name: "firefox" }
    - { name: "vim"}
    - { name: "zsh"}
    - { name: "ruby"}
    - { name: "golang"}
    - { name: "python3.11" }
    - { name: "git" }
    - { name: "cmake" }
    - { name: "nodejs" }
    - { name: "gpg" }
    - { name: "openssh-server" }
    - { name: "zsh" }
    - { name: "konsole" }
    - { name: "codium" }
    - { name: "google-cloud-sdk" }
    - { name: "awscli" }
    - { name: "azure-cli" }
    - { name: "eza" }
    - { name: "tofu" }
    - { name: "packer" } # TODO: if open source replacement becomes availabe, then we will replace.
    - { name: "vault" } # TODO: if open source replacement becomes availabe, then we will replace.
  loop_control:
    loop_var: dnf_package
  #when: dnf_cache_updated is changed

- name: "Set variable required_packages to true."
  ansible.builtin.set_fact:
    required_packages: true
